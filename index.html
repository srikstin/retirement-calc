<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retirement Calculator</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 16px; background: #f2f2f7; color: #1c1c1e; }
        h2 { text-align: center; margin-bottom: 15px; }
        .card { background: white; padding: 16px; border-radius: 14px; box-shadow: 0 3px 12px rgba(0,0,0,0.08); margin-bottom: 16px; }
        .tabs { display: flex; border-bottom: 1px solid #d1d1d6; margin-bottom: 15px; gap: 5px; overflow-x: auto; }
        .tab-link { position: relative; padding: 10px 15px; cursor: pointer; font-size: 14px; font-weight: 600; color: #8e8e93; border: none; background: none; border-bottom: 2px solid transparent; transition: 0.2s; white-space: nowrap; }
        .tab-link.active { color: #007aff; border-bottom: 2px solid #007aff; }
        .indicator::after { content: ''; position: absolute; top: 5px; right: 5px; width: 7px; height: 7px; background-color: #34c759; border-radius: 50%; border: 1px solid white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        label { font-weight: 600; font-size: 14px; display: block; margin-top: 10px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; font-size: 16px; border-radius: 10px; border: 1px solid #d1d1d6; box-sizing: border-box; }
        .radio-group { margin: 10px 0; display: flex; gap: 20px; }
        .radio-group label { font-weight: normal; margin: 0; display: flex; align-items: center; gap: 8px; }
        .radio-group input { width: 20px; height: 20px; margin: 0; }
        .disabled { opacity: 0.3; pointer-events: none; background: #f9f9f9; }
        .table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 12px; min-width: 600px; }
        th, td { padding: 10px; text-align: right; border-bottom: 1px solid #f2f2f7; }
        th { background: #f9f9fb; font-weight: 600; }
        .negative-red { color: #ff3b30; font-weight: 500; }
        .summary { font-size: 16px; font-weight: 700; margin-bottom: 15px; padding: 15px; background: #007aff; color: white; border-radius: 10px; display: flex; justify-content: space-between; }
        .audit-section { margin-top: 20px; border-top: 2px dashed #d1d1d6; padding-top: 20px; }
        .footer { text-align: center; margin-top: 30px; padding-bottom: 20px; font-size: 12px; color: #8e8e93; }
        .footer a { color: #007aff; text-decoration: none; font-weight: 600; font-size: 14px; }
        .note-text { font-size: 12px; color: #666; margin-top: 10px; line-height: 1.4; }
    </style>
</head>
<body>

    <h2>Savings & Retirement Calculator</h2>

    <div class="card">
        <div class="tabs">
            <button id="link-tab1" class="tab-link active" onclick="openTab(event, 'tab1')">Investment</button>
            <button id="link-tab2" class="tab-link" onclick="openTab(event, 'tab2')">Tax</button>
            <button id="link-tab3" class="tab-link" onclick="openTab(event, 'tab3')">Withdrawals</button>
            <button id="link-tab4" class="tab-link" onclick="openTab(event, 'tab4')">Inflation</button>
        </div>

        <div id="tab1" class="tab-content active">
            <label>Principal ($)</label>
            <input type="number" id="principal" value="100000" inputmode="decimal">
            <label>Monthly Interest Rate (%)</label>
            <input type="number" id="monthlyRate" value="2" step="0.1" inputmode="decimal">
            <label>Years</label>
            <input type="number" id="years" value="30" inputmode="numeric">
            <label>Compounding Frequency (per year)</label>
            <input type="number" id="frequency" value="12" inputmode="numeric">
        </div>

        <div id="tab2" class="tab-content">
            <label>Tax Regime</label>
            <select id="regime">
                <option value="Personal">Personal (Stage 3 + Medicare)</option>
                <option value="SMSF">SMSF (15%)</option>
                <option value="NoTax" selected>No Tax</option>
            </select>
            <div id="medicareSection">
                <label>Apply 2% Medicare Levy?</label>
                <div class="radio-group">
                    <label><input type="radio" name="medicare" value="no" checked> No</label>
                    <label><input type="radio" name="medicare" value="yes"> Yes</label>
                </div>
            </div>
        </div>

        <div id="tab3" class="tab-content">
            <label>Monthly Withdrawal ($)</label>
            <input type="number" id="withdrawal" value="0" inputmode="decimal">
            <label>Start Withdrawals (Year)</label>
            <input type="number" id="withdrawYear" value="0" inputmode="numeric">
            <div id="pensionSection">
                <label>Pension Start Year (SMSF only)</label>
                <input type="number" id="pensionYear" value="0" inputmode="numeric">
            </div>
        </div>

        <div id="tab4" class="tab-content">
            <label>Annual Inflation Rate (%)</label>
            <input type="number" id="inflation" value="0" step="0.1" inputmode="decimal">
            <p class="note-text">* Adjusts ending balance AND grows withdrawal amounts annually to maintain purchasing power.</p>
        </div>
    </div>

    <div class="card table-wrap">
        <div id="summaryBox" class="summary"></div>
        <div id="resultTable"></div>

        <div class="audit-section">
            <label>Audit Year (Monthly Breakdown):</label>
            <input type="number" id="auditYearInput" placeholder="Enter year" style="width: 200px;" oninput="calculate()">
            <div id="auditResultTable" class="table-wrap"></div>
        </div>
    </div>

    <div class="footer">
        <a href="logic.html" target="_blank">How this calculator works</a><br><br>
        Version 1.0
    </div>

<script>
    function openTab(evt, tabName) {
        let i, tabcontent, tablinks;
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) { tabcontent[i].classList.remove("active"); }
        tablinks = document.getElementsByClassName("tab-link");
        for (i = 0; i < tablinks.length; i++) { tablinks[i].classList.remove("active"); }
        document.getElementById(tabName).classList.add("active");
        evt.currentTarget.classList.add("active");
    }

    function personalTax(income, medicare) {
        let tax = 0;
        const rateAdd = medicare ? 0.02 : 0;
        let rem = income;
        if (rem > 190000) { tax += (rem - 190000) * (0.45 + rateAdd); rem = 190000; }
        if (rem > 135000) { tax += (rem - 135000) * (0.37 + rateAdd); rem = 135000; }
        if (rem > 45000) { tax += (rem - 45000) * (0.30 + rateAdd); rem = 45000; }
        if (rem > 18200) { tax += (rem - 18200) * (0.16 + rateAdd); }
        return tax;
    }

    function formatCurrency(val, isNegativeStyle) {
        const rounded = Math.round(val);
        const formatted = rounded.toLocaleString('en-AU');
        if (isNegativeStyle && val > 0) { return `<span class="negative-red">($${formatted})</span>`; }
        return `$${formatted}`;
    }

    function calculate() {
        const regime = document.getElementById("regime").value;
        const withdrawalVal = parseFloat(document.getElementById("withdrawal").value) || 0;
        const inflationVal = parseFloat(document.getElementById("inflation").value) || 0;

        document.getElementById("medicareSection").className = (regime === "Personal") ? "" : "disabled";
        document.getElementById("pensionSection").className = (regime === "SMSF") ? "" : "disabled";

        document.getElementById("link-tab2").classList.toggle("indicator", regime !== "NoTax");
        document.getElementById("link-tab3").classList.toggle("indicator", withdrawalVal > 0);
        document.getElementById("link-tab4").classList.toggle("indicator", inflationVal > 0);

        let balance = parseFloat(document.getElementById("principal").value) || 0;
        const mRate = (parseFloat(document.getElementById("monthlyRate").value) || 0) / 100;
        const years = parseInt(document.getElementById("years").value) || 0;
        const freq = parseInt(document.getElementById("frequency").value) || 1;
        const withStart = parseInt(document.getElementById("withdrawYear").value) || 0;
        const penStart = parseInt(document.getElementById("pensionYear").value) || 0;
        const inflationRate = inflationVal / 100;
        const auditYear = parseInt(document.getElementById("auditYearInput").value) || 0;
        const medicareChecked = document.querySelector('input[name="medicare"]:checked');
        const medicare = medicareChecked ? (medicareChecked.value === 'yes') : false;

        const pRate = mRate * (12 / freq);
        let tableBody = "", auditBody = "", totalTaxPaid = 0;

        for (let y = 1; y <= years; y++) {
            let startBal = balance, yrInt = 0, yrWith = 0;
            let infMult = Math.pow(1 + inflationRate, y - 1);
            let monthlyWith = (withStart === 0 || y >= withStart) ? withdrawalVal * infMult : 0;
            
            for (let p = 1; p <= freq; p++) {
                let monthStart = balance;
                let take = Math.min(balance, monthlyWith);
                balance -= take; 
                let earned = balance * pRate;
                balance += earned;
                yrWith += take; yrInt += earned;

                if (y === auditYear) {
                    auditBody += `<tr><td>Mth ${p}</td><td>${formatCurrency(monthStart)}</td><td>${formatCurrency(take, true)}</td><td>${formatCurrency(earned)}</td><td>${formatCurrency(balance)}</td></tr>`;
                }
                if (balance <= 0) { balance = 0; break; }
            }

            let tax = (regime === "SMSF") ? ((penStart > 0 && y >= penStart) ? 0 : yrInt * 0.15) : (regime === "Personal" ? personalTax(yrInt, medicare) : 0);
            balance -= tax; if (balance < 0) balance = 0;
            totalTaxPaid += tax;

            let endNominal = balance + tax;
            let inflationAdjEnd = balance / (1 + inflationRate);

            tableBody += `<tr><td>${y}</td><td>${formatCurrency(startBal)}</td><td><b>${formatCurrency(inflationAdjEnd)}</b></td><td>${formatCurrency(yrInt)}</td><td>${formatCurrency(yrWith, true)}</td><td>${formatCurrency(tax)}</td><td>${formatCurrency(endNominal - tax)}</td></tr>`;
            
            balance = inflationAdjEnd;
            if (balance <= 0) break;
        }

        document.getElementById("summaryBox").innerHTML = `<span>Ending Balance: ${formatCurrency(balance)}</span><span>Total Tax: ${formatCurrency(totalTaxPaid)}</span>`;
        document.getElementById("resultTable").innerHTML = `<table><thead><tr><th>Yr</th><th>Start</th><th>Inflation adj. End</th><th>Interest</th><th>Withdr</th><th>Tax</th><th>End</th></tr></thead><tbody>${tableBody}</tbody></table>`;
        
        if (auditYear > 0) {
            document.getElementById("auditResultTable").innerHTML = `<table><thead><tr><th>Period</th><th>Start</th><th>Withdr</th><th>Interest</th><th>End</th></tr></thead><tbody>${auditBody}</tbody></table>`;
        } else {
            document.getElementById("auditResultTable").innerHTML = "";
        }
    }

    document.addEventListener("DOMContentLoaded", function() {
        const inputs = document.querySelectorAll('input, select');
        inputs.forEach(el => { el.addEventListener('input', calculate); el.addEventListener('change', calculate); });
        calculate();
    });
</script>
</body>
</html>

