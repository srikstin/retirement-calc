<!DOCTYPE html>
<html lang="en-AU">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Retirement Calculator</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; padding: 16px; background: #f2f2f7; color: #1c1c1e; }
        h2 { text-align: center; margin-bottom: 15px; }
        .card { background: white; padding: 16px; border-radius: 14px; box-shadow: 0 3px 12px rgba(0,0,0,0.08); margin-bottom: 16px; }
        label { font-weight: 600; font-size: 14px; display: block; margin-top: 10px; }
        input, select { width: 100%; padding: 12px; margin: 8px 0; font-size: 16px; border-radius: 10px; border: 1px solid #d1d1d6; box-sizing: border-box; }
        .radio-group { margin: 10px 0; display: flex; gap: 20px; }
        .radio-group label { font-weight: normal; margin: 0; display: flex; align-items: center; gap: 8px; }
        .radio-group input { width: 20px; height: 20px; margin: 0; }
        .disabled { opacity: 0.3; pointer-events: none; background: #f9f9f9; }
        .table-wrap { overflow-x: auto; -webkit-overflow-scrolling: touch; margin-top: 10px; }
        table { width: 100%; border-collapse: collapse; font-size: 13px; min-width: 500px; }
        th, td { padding: 10px; text-align: right; border-bottom: 1px solid #f2f2f7; }
        th { background: #f9f9fb; font-weight: 600; }
        
        /* New Formatting Styles */
        .negative-red { color: #ff3b30; font-weight: 500; }
        .summary { font-size: 16px; font-weight: 700; margin-bottom: 15px; padding: 15px; background: #007aff; color: white; border-radius: 10px; text-align: center; }
        hr { border: 0; border-top: 1px solid #eee; margin: 15px 0; }
    </style>
</head>
<body>

    <h2>Retirement Calculator</h2>

    <div class="card">
        <label>Principal ($)</label>
        <input type="number" id="principal" value="100000" inputmode="decimal">
        
        <label>Monthly Interest Rate (%)</label>
        <input type="number" id="monthlyRate" value="2" step="0.1" inputmode="decimal">
        
        <label>Years</label>
        <input type="number" id="years" value="30" inputmode="numeric">
        
        <label>Compounding Frequency (per year)</label>
        <input type="number" id="frequency" value="12" inputmode="numeric">
        
        <label>Tax Regime</label>
        <select id="regime">
            <option value="Personal">Personal (Stage 3 + Medicare)</option>
            <option value="SMSF" selected>SMSF (15%)</option>
            <option value="NoTax">No Tax</option>
        </select>

        <div id="medicareSection">
            <label>Apply 2% Medicare Levy?</label>
            <div class="radio-group">
                <label><input type="radio" name="medicare" value="no" checked> No</label>
                <label><input type="radio" name="medicare" value="yes"> Yes</label>
            </div>
        </div>

        <hr>
        
        <label>Monthly Withdrawal ($)</label>
        <input type="number" id="withdrawal" value="100" inputmode="decimal">
        
        <label>Start Withdrawals (Year)</label>
        <input type="number" id="withdrawYear" value="1" inputmode="numeric">
        
        <div id="pensionSection">
            <label>Pension Start Year (SMSF only)</label>
            <input type="number" id="pensionYear" value="0" inputmode="numeric">
        </div>
    </div>

    <div class="card table-wrap" id="resultContainer">
        <div id="summaryBox" class="summary"></div>
        <div id="resultTable"></div>
    </div>

<script>
    function personalTax(income, medicare) {
        let tax = 0;
        const rateAdd = medicare ? 0.02 : 0;
        let rem = income;
        if (rem > 190000) { tax += (rem - 190000) * (0.45 + rateAdd); rem = 190000; }
        if (rem > 135000) { tax += (rem - 135000) * (0.37 + rateAdd); rem = 135000; }
        if (rem > 45000) { tax += (rem - 45000) * (0.30 + rateAdd); rem = 45000; }
        if (rem > 18200) { tax += (rem - 18200) * (0.16 + rateAdd); }
        return tax;
    }

    function formatCurrency(val, isNegativeStyle) {
        const rounded = Math.round(val);
        const formatted = rounded.toLocaleString('en-AU');
        if (isNegativeStyle && val > 0) {
            return `<span class="negative-red">($${formatted})</span>`;
        }
        return `$${formatted}`;
    }

    function calculate() {
        const regime = document.getElementById("regime").value;
        const medicareSection = document.getElementById("medicareSection");
        const pensionSection = document.getElementById("pensionSection");

        medicareSection.className = (regime === "Personal") ? "" : "disabled";
        pensionSection.className = (regime === "SMSF") ? "" : "disabled";

        let balance = parseFloat(document.getElementById("principal").value) || 0;
        const mRate = (parseFloat(document.getElementById("monthlyRate").value) || 0) / 100;
        const years = parseInt(document.getElementById("years").value) || 0;
        const freq = parseInt(document.getElementById("frequency").value) || 1;
        const baseWith = parseFloat(document.getElementById("withdrawal").value) || 0;
        const withStart = parseInt(document.getElementById("withdrawYear").value) || 1;
        const penStart = parseInt(document.getElementById("pensionYear").value) || 0;
        const medicareChecked = document.querySelector('input[name="medicare"]:checked');
        const medicare = medicareChecked ? (medicareChecked.value === 'yes') : false;

        const pRate = mRate * (12 / freq);
        let tableBody = "";
        let totalTaxPaid = 0;

        for (let y = 1; y <= years; y++) {
            let startBal = balance;
            let yrInt = 0;
            let yrWith = 0;
            let adjWith = (y >= withStart) ? baseWith : 0;

            for (let p = 1; p <= freq; p++) {
                // Withdrawal before interest
                let take = Math.min(balance, adjWith);
                balance -= take;
                yrWith += take;

                let earned = balance * pRate;
                balance += earned;
                yrInt += earned;

                if (balance <= 0) { balance = 0; break; }
            }

            let tax = 0;
            if (regime === "SMSF") {
                tax = (penStart > 0 && y >= penStart) ? 0 : yrInt * 0.15;
            } else if (regime === "Personal") {
                tax = personalTax(yrInt, medicare);
            }
            
            balance -= tax;
            if (balance < 0) balance = 0;
            totalTaxPaid += tax;

            tableBody += "<tr>" +
                "<td>" + y + "</td>" +
                "<td>" + formatCurrency(startBal) + "</td>" +
                "<td>" + formatCurrency(yrInt) + "</td>" +
                "<td>" + formatCurrency(yrWith, true) + "</td>" +
                "<td>" + formatCurrency(tax) + "</td>" +
                "<td><b>" + formatCurrency(balance) + "</b></td>" +
                "</tr>";
            
            if (balance <= 0) break;
        }

        const tableHeader = "<thead><tr><th>Yr</th><th>Start</th><th>Interest</th><th>Withdr</th><th>Tax</th><th>End</th></tr></thead>";
        document.getElementById("summaryBox").innerHTML = "Final: " + formatCurrency(balance) + " | Total Tax: " + formatCurrency(totalTaxPaid);
        document.getElementById("resultTable").innerHTML = "<table>" + tableHeader + "<tbody>" + tableBody + "</tbody></table>";
    }

    document.addEventListener("DOMContentLoaded", function() {
        const inputs = document.querySelectorAll('input, select');
        for (let i = 0; i < inputs.length; i++) {
            inputs[i].addEventListener('input', calculate);
            inputs[i].addEventListener('change', calculate);
        }
        calculate();
    });
</script>
</body>
</html>
